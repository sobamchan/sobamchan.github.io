# 2020-09-01

sotaro.io/daily の filename の変更をしていた．
jekyll 的に title は必須なので，適当に 日付の後に，
"journal" という文字列を全エントリーにつけていくことにした．

note, wiki コマンドの alias, function を作成した．
note で日毎，wiki でトピックごとのエントリーを作成する．


## proposal

- [x] 前年の proposal から更新できる手法のところを抽出し，リスト化
- [x] 手法の各コンポーネントリスト化
  - 思ったよりシンプルな技術構成になってたな
  - モデルの提案というよりも，injection の framework の提案が多い．
- [x] 更新に使えそうな関連研究をリストアップ
- [x] ↑ 論文を読んでいく / 利用できそうな手法は 1 の各アイテムに追記していく．

adapter module 中心に 調査・考察 した．

◎ YouTube のテレビ表を作る
  YouTube TV
  視聴者が動画を選択する自由を奪う，だらだらにすぐ入れるようになる．

バスク風チーズケーキを 3 pm うまい


# 2020-09-02

## Zhao2020 (masking layer) と adapter moduleの比較
transformer の 各 block に新規のレイヤーを挟むという意味では，二つともほとんど同じ．
masking layer の方は，finetuning 後に binarize するのでメモリ効率が良いということだけ．

multi modal, bert 以外にモデルを使う，時の Adapter module の良い適応方法を考える．

## Buildit
- [ ] dill を使わない model & pipeline の serialize の実装にする．
  - [x] svc の param を抽出して json で保持
    - deserialize 時に型も復元する必要
    - dummy data では動いた．全体が完成してからちゃんと動作確認する．
  - [x] tfidf vector serialize
  - [x] pca serialize

というか，問題なのは pipeline のところなのではないか？
依存関係の問題があるのが．
ここをきれいに移植したら，scikit-learn に関してはそのまま pickle を使っていいのか．

svc の json serialize code を書いたところでこれに気づいた．
特徴量抽出のところかく

## proposal, adapter module 以外のコンセプト
- Graph
  - Graph (つまり hardcoded, explicit な format) として知識を記述できれば transferable である．
- External Memory
  - adapter は学習パラメータを内包するが，それを外に持っていてもいい

transfer, external, knowledge で acl 2020 のタイトルを探索
paperpile にいくつか登録した，読んでいく．

---

# 2020-09-03

## Buildit
model serialization funcs は終わっている．
次は特徴量抽出 pipeline を切り出し．

- [x] 学習関数を json serialize するように改変
  - json serialize 不可なものが入っているのでテストを書いて問題の同定 -> tfidf だった
  - stop_words_ が set() でそれがダメっぽい
  - (Pdb) init_params["dtype"] <class 'numpy.float64'>
- [x] pipeline で保持している前処理群を関数で整理する．
  - TfidfFeatTransformer を params dict から再現する関数を書く → Done
- [ ] model files を cai に載せていく作業
  - [x] json load を各モデルにするのに必要な時間を調べる → 推論毎にロードしてもいいかも？
    - `construct_tfidf_feat_transformer` に 3s かかってる

```python
// こんな感じでモデルにアクセスができる．
gs = GridSearchCV(pipe, param_grid=param_grid, cv=2, n_jobs=-1)
gs.best_estimator_["clf"].predict
```

- [x] 勉強会の用意, 名寄せ

やった
- 学習コードから特徴量抽出コードの切り出し
- [WIP] cai への移植
- 勉強会資料作成


---

# 2020-09-04

- [ent](http://entgo.io/)

## Buildit
- cai へのインテグレーションを引き続き進める．
  - とりあえず推論毎にロードする実装でいく
  - [x] 必要なファイルを移植する
    - [x] TfidfFeatTransformer
    - [x] deserialize 系
  - [x] 実験と同じ設定で分かち書き  (終わってた)
  - [x] 実験と同じ設定で前処理  (終わってた)
  - [x] model を local から load する
  - [x] とりあえずの動作確認 → Good
  - [x] `predict_proba` を使うように変更
  - [x] 内部の w2v model を local のを参照
    - binary_classification で memory-load している変数を使いたい
    - 学習時は shiroyagi (dim=50), infer は独自 (dim=200), 学習時を合わせる
  - 全体の test は通った

次回
- view classification の test
- singleton でちゃんと実装できていない？ global 変数は使わんくて良いはず．


---


2020-09-07

# Proposal

## 読む

- mad-x
- Learning multiple visual domains with residual adapters

## 書く
- [ ] 新規に追加する手法, 取捨選択する
- [ ] 手法のタイトルとその概要をリストにする
- [ ] 既存手法の更新部分
  - 割とそのままでいいのか？
  - モデルに関しては bert そのままだったので，それを更新するだけでいいかも


# Other

- [ロイヤルパークホテル](https://advance.reservation.jp/rphs/stay_pc/rsv/rsv_src_pln.aspx?hi_id=3&lang=ja-JP&dt=2020/09/19&mc=2&rc=1&pmin=0&le=1&pmax=2147483647&cond=or&cc=&st=0&ra=&du=0&pa=#175432)
  - 4.7 万 (3.0 万 w/ goto)
  - 2.4 万, フレンチ, 5 千，ワイン

- [横浜ベイホテル東急](https://www.ozmall.co.jp/travel/stay/3/restaurant/)
  - 2万
  - 2万, レストラン，フレンチ

- [横浜ベイシェラトン](https://www.marriott.co.jp/hotels/travel/tyoys-yokohama-bay-sheraton-hotel-and-towers/)

値段はそこまでかわらん．
ならロイヤルパークホテルがかっこいいのか．
トータルで 8 万を上回ることはなさそう．

少し mux で api を書いてみたけど，構造がこれでいいかよくわからんし，
開発の手順的なのも怪しい．


---


2020-09-08

# proposal

- [x] 手法提案をもう少し出す．(2020-09-07 時点で 2 つ)
  - [x] 色推定のやつは評価用タスクとして書く
  - 今日足したのは ↑ の 1 つだけだけど，とりあえずよしとする
- [x] google document を用意して，手法の説明を書き始める
  - 最終的に goran に share するもの
  - 開始はした．
  - 2019 の概要は書いて，今，追加手法のベースとなる論文の説明を書いている．
  - 新手法はもう少しちゃんと考えないと英語では書けないな．

# Other
- [x] 場所を確定して予約


---


2020-09-09

# proposal

- [ ] wiki に書いている新手法のプロットをもう少しちゃんと練る
  - stacking adapter に関しては少し細かく練った on paper

# buildit

- [x] model を storage から利用するように実装変更
- [ ] view classification の test
  - [x] validator
  - [x] infer endpoint
- [x] singleton でちゃんと実装できていない？ global 変数は使わんくて良いはず．
  - 実装をどうすれば良いかはわかった．
  - 現 PR ではカバーすべきではないので，issue を作成して別に取り組む

明日
- staging でちゃんと動作検証する
- tomita-san に pr review 依頼
- singleton に関しての issue 作成
